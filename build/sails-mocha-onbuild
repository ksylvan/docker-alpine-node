FROM mhart/alpine-node:5.8.0

MAINTAINER Kayvan Sylvan <kayvansylvan@gmail.com>

RUN apk update && apk upgrade
RUN apk add python postgresql-dev make g++
RUN npm install -g sails mocha

ONBUILD COPY package.json /usr/src/app/
ONBUILD RUN npm install
ONBUILD COPY . /usr/src/app

RUN apk del python postgresql-dev make g++ && \
  rm /usr/share/man /tmp/* /var/cache/apk/* /root/.npm \
    /root/.node-gyp /root/.gnupg /usr/lib/node_modules/npm/man \
    /usr/lib/node_modules/npm/doc /usr/lib/node_modules/npm/html
CMD [ "npm", "start" ]
